generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

//Master entry=======================================================================================================================================================

model category_master {
    id                  String                @id @default(uuid())
    name                String                @unique
    subcategory_master  subcategory_master[]
    createdAt           DateTime              @default(now())
    updatedAt           DateTime              @updatedAt
    inventory           inventory[]
    procurement         procurement[]
    procurement_history procurement_history[]
}

model subcategory_master {
    id                  String                @id @default(uuid())
    name                String                @unique
    category            category_master       @relation(fields: [category_masterId], references: [id])
    category_masterId   String
    createdAt           DateTime              @default(now())
    updatedAt           DateTime              @updatedAt
    inventory           inventory[]
    brand_master        brand_master[]
    procurement         procurement[]
    procurement_history procurement_history[]
}

model brand_master {
    id                   String                @id @default(uuid())
    name                 String                @unique
    subcategory          subcategory_master?   @relation(fields: [subcategory_masterId], references: [id])
    subcategory_masterId String?
    createdAt            DateTime              @default(now())
    updatedAt            DateTime              @updatedAt
    inventory            inventory[]
    procurement          procurement[]
    procurement_history  procurement_history[]
}

// pre-procurement============================================================================================================================================================================================================================================================================================================

model procurement_status {
    id             String        @id @default(uuid())
    procurement_no String        @unique
    status         Int //-2=rejected, -1=back to sr, 0=pending, 1=in DA's inbox, 69= revised and in DA's inbox, 2=released for tender,3=supplier assigned,4=stock partially recieved, 5=stock recieved, 6=stock verified
    createdAt      DateTime      @default(now())
    updatedAt      DateTime      @updatedAt
    procurement    procurement[]
}

model sr_pre_procurement_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model sr_pre_procurement_outbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model da_pre_procurement_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model da_pre_procurement_outbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

// post-procurement============================================================================================================================================================================================================================================================================================================

model da_post_procurement_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model da_post_procurement_outbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model sr_post_procurement_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

// received inventory============================================================================================================================================================================================================================================================================================================

model receivings {
    id                 String            @id @default(uuid())
    procurement_no     String?
    receiving_no       String            @unique
    date               DateTime?         @db.Date
    received_quantity  Int?
    remaining_quantity Int?
    is_added           Boolean           @default(false)
    remark             String?
    procurement        procurement?      @relation(fields: [procurement_no], references: [procurement_no])
    createdAt          DateTime          @default(now())
    updatedAt          DateTime          @updatedAt
    receiving_image    receiving_image[]
    procurementId      String
}

model receiving_image {
    id           String      @id @default(uuid())
    ReferenceNo  String
    uniqueId     String?
    receiving    receivings? @relation(fields: [receiving_no], references: [receiving_no])
    receiving_no String?
    createdAt    DateTime    @default(now())
    updatedAt    DateTime    @updatedAt
}

model da_received_inventory_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model da_received_inventory_outbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model sr_received_inventory_inbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model sr_received_inventory_outbox {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

//inventory============================================================================================================================================================================================================================================================================================================

model inventory {
    id                   String              @id @default(uuid())
    category             category_master?    @relation(fields: [category_masterId], references: [id])
    category_masterId    String?
    subcategory          subcategory_master? @relation(fields: [subcategory_masterId], references: [id])
    subcategory_masterId String?
    brand                brand_master?       @relation(fields: [brand_masterId], references: [id])
    brand_masterId       String?
    description          String?
    quantity             Int                 @default(0)
    createdAt            DateTime            @default(now())
    updatedAt            DateTime            @updatedAt
}

model dead_stock {
    id               String             @id @default(uuid())
    procurement_no   String             @unique
    quantity         Int
    createdAt        DateTime           @default(now())
    updatedAt        DateTime           @updatedAt
    dead_stock_image dead_stock_image[]
}

model dead_stock_image {
    id             String     @id @default(uuid())
    procurement_no String     @unique
    ReferenceNo    String
    uniqueId       String?
    dead_stock     dead_stock @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime   @default(now())
    updatedAt      DateTime   @updatedAt
}

//procurement============================================================================================================================================================================================================================================================================================================

model procurement {
    id                           String                        @id @default(uuid())
    procurement_no               String                        @unique
    category                     category_master?              @relation(fields: [category_masterId], references: [id])
    category_masterId            String?
    subcategory                  subcategory_master?           @relation(fields: [subcategory_masterId], references: [id])
    subcategory_masterId         String?
    brand                        brand_master?                 @relation(fields: [brand_masterId], references: [id])
    brand_masterId               String?
    description                  String?
    quantity                     Int                           @default(0)
    rate                         Float?
    total_rate                   Float?
    isEdited                     Boolean                       @default(false)
    is_partial                   Boolean                       @default(true)
    status                       procurement_status            @relation(fields: [statusId], references: [id])
    statusId                     String
    remark                       String?
    createdAt                    DateTime                      @default(now())
    updatedAt                    DateTime                      @updatedAt
    sr_pre_procurement_inbox     sr_pre_procurement_inbox?
    sr_pre_procurement_outbox    sr_pre_procurement_outbox?
    da_pre_procurement_inbox     da_pre_procurement_inbox?
    da_pre_procurement_outbox    da_pre_procurement_outbox?
    da_post_procurement_inbox    da_post_procurement_inbox?
    post_procurement             post_procurement?
    da_post_procurement_outbox   da_post_procurement_outbox?
    sr_post_procurement_inbox    sr_post_procurement_inbox?
    receivings                   receivings[]
    da_received_inventory_inbox  da_received_inventory_inbox?
    da_received_inventory_outbox da_received_inventory_outbox?
    sr_received_inventory_inbox  sr_received_inventory_inbox?
    sr_received_inventory_outbox sr_received_inventory_outbox?
}

model post_procurement {
    id             String      @id @default(uuid())
    procurement_no String      @unique
    supplier_name  String?
    gst_no         String?
    final_rate     Float?
    gst            Float?
    total_quantity Int?
    total_price    Float?
    unit_price     Float?
    is_gst_added   Boolean     @default(false)
    procurement    procurement @relation(fields: [procurement_no], references: [procurement_no])
    createdAt      DateTime    @default(now())
    updatedAt      DateTime    @updatedAt
}

model procurement_history {
    id                   String              @id @default(uuid())
    procurement_no       String              @unique
    category             category_master?    @relation(fields: [category_masterId], references: [id])
    category_masterId    String?
    subcategory          subcategory_master? @relation(fields: [subcategory_masterId], references: [id])
    subcategory_masterId String?
    brand                brand_master?       @relation(fields: [brand_masterId], references: [id])
    brand_masterId       String?
    description          String?
    quantity             Int                 @default(0)
    isEdited             Boolean             @default(false)
    status               Int
    createdAt            DateTime            @default(now())
    updatedAt            DateTime            @updatedAt
}
